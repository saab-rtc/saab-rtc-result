<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SAAB RTC - CNIC Result</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background: #f0f0f0;
      padding: 20px;
    }
    .container {
      max-width: 900px;
      margin: auto;
      background: #fff;
      padding: 30px;
      border: 2px solid #000080;
      position: relative;
    }
    .header {
      text-align: center;
      border-bottom: 2px solid #000080;
      padding-bottom: 10px;
    }
    .header h2 {
      margin: 0;
      font-size: 24px;
      text-transform: uppercase;
    }
    .header h3 {
      margin: 0;
      font-size: 18px;
      color: red;
    }
    .photo {
      position: absolute;
      top: 30px;
      right: 30px;
      border: 2px solid #000;
    }
    .info {
      margin-top: 20px;
      line-height: 1.6;
      font-size: 16px;
    }
    .info strong {
      width: 160px;
      display: inline-block;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      font-size: 15px;
    }
    th, td {
      border: 1px solid #000;
      padding: 8px;
      text-align: center;
    }
    th {
      background-color: #dbe5f1;
    }
    .footer {
      margin-top: 20px;
      font-size: 16px;
    }
    .print-btn {
      margin-top: 20px;
      text-align: center;
    }
    .print-btn button {
      background-color: #004d26;
      color: white;
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      cursor: pointer;
    }
    .developer-credit {
      margin-top: 40px;
      font-style: italic;
      text-align: center;
      color: #555;
    }
  </style>
</head>
<body>
  <div class="search-box" style="text-align:center; margin-bottom: 30px;">
    <h2>SAAB RTC HYDERABAD - CNIC RESULT SYSTEM</h2>
    <input type="text" id="searchInput" placeholder="Enter CNIC e.g. 42201-1234567-1" style="padding: 10px; width: 300px; font-size: 16px;">
    <button onclick="searchResult()" style="padding: 10px 20px; font-size: 16px; background: green; color: white; border: none;">Search</button>
  </div>
  
  <div id="resultContainer"></div>

  <script>
    const sheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSpxIiO_3HjHPwBUZ3EHou1XfVBJLWB0GAWFbxvCWD6Vm0aXB8Ky8CGoMUYj5Po4gpUWsJOUPUWVO34/pub?gid=1524641333&single=true&output=csv';
    const proxy = 'https://corsproxy.io/?';
    let allResults = [];

    async function loadData() {
      const res = await fetch(proxy + encodeURIComponent(sheetUrl));
      const data = await res.text();
      allResults = parseCSV(data);
    }

    function parseCSV(csv) {
      const lines = csv.split('\n');
      const headers = lines[0].split(',');
      const result = [];
      for (let i = 1; i < lines.length; i++) {
        const obj = {};
        const currentline = lines[i].split(',');
        headers.forEach((h, j) => obj[h.trim()] = currentline[j]?.trim() || '');
        result.push(obj);
      }
      return result;
    }

    function searchResult() {
      const input = document.getElementById('searchInput').value.replace(/[-\s]/g, '');
      const trainee = allResults.find(t => t['CNIC'].replace(/[-\s]/g, '') === input);
      const container = document.getElementById('resultContainer');

      if (!trainee) {
        container.innerHTML = `<p style='color:red; text-align:center;'>No result found for this CNIC.</p>`;
        return;
      }

      const html = `
        <div class="container" id="marksheet">
          <div class="header">
            <h2>SHAHEED ABDUL AZIZ BULLO<br>RECRUIT TRAINING CENTER HYDERABAD</h2>
            <h3>MARKS CERTIFICATE</h3>
            <p>Result of Final Examination of Lower School Course Batch (LSC/01/2025)<br>Held from 16.06.2025 to 25.06.2025</p>
          </div>
          <img class="photo" src="${trainee.PhotoURL}" alt="Trainee Photo" width="100" height="120">
          <div class="info">
            <p><strong>ROLL / SEAT NO:</strong> ${trainee.SeatNo}</p>
            <p><strong>RANK & B.NO:</strong> ${trainee.Rank}</p>
            <p><strong>NAME:</strong> ${trainee.Name}</p>
            <p><strong>FATHER'S NAME:</strong> ${trainee.FatherName}</p>
            <p><strong>CNIC NO:</strong> ${trainee.CNIC}</p>
            <p><strong>ARRIVAL DIST./UNIT:</strong> ${trainee.Unit}</p>
          </div>
          <table>
            <thead>
              <tr><th>Subject</th><th>Max Marks</th><th>Obtained</th><th>Remarks</th></tr>
            </thead>
            <tbody>
              ${createRows(trainee)}
            </tbody>
          </table>
          <div class="footer">
            <p><strong>Total:</strong> 1500 &nbsp;&nbsp;&nbsp; <strong>Obtained:</strong> ${trainee.Total}</p>
            <p><strong>Percentage:</strong> ${trainee.Percentage} &nbsp;&nbsp;&nbsp; <strong>Grade:</strong> ${trainee.Grade}</p>
            <p><strong>Result:</strong> ${trainee.Result}</p>
          </div>
          <div class="developer-credit">System Developed by: Mohsin Ali Jamali (Exam Branch â€“ RTC Hyderabad)</div>
        </div>
        <div class="print-btn">
          <button onclick="printDiv()">Print / Download PDF</button>
        </div>
      `;
      container.innerHTML = html;
    }

    function createRows(t) {
      const subjects = [
        'Legal Knowledge','CrPC & Police Rules','PPW & Forensic Sci','General Knowledge','Investigation',
        'Operation','Security','Intelligence','Module 01 to 20','English Language & Professional Skills',
        'Prade & Drill','Physical & Fitness','Musketry & Firing','Discipline','Viva Voce'
      ];
      return subjects.map(sub => `
        <tr>
          <td>${sub}</td>
          <td>${sub === 'Module 01 to 20' ? 200 : sub === 'Discipline' || sub === 'Viva Voce' ? 50 : 100}</td>
          <td>${t[sub]}</td>
          <td>${(parseInt(t[sub]) >= (sub === 'Module 01 to 20' ? 80 : sub === 'Discipline' || sub === 'Viva Voce' ? 20 : 40)) ? 'PASS' : 'FAIL'}</td>
        </tr>
      `).join('');
    }

    function printDiv() {
      const printContents = document.getElementById('marksheet').innerHTML;
      const newWin = window.open('', '', 'height=800,width=800');
      newWin.document.write('<html><head><title>Print Result</title>');
      newWin.document.write('</head><body >');
      newWin.document.write(printContents);
      newWin.document.write('</body></html>');
      newWin.document.close();
      newWin.print();
    }

    window.onload = loadData;
  </script>
</body>
</html>
